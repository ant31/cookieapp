sudo: required

services:
  - docker

language: python

before_install:
  - curl https://github.com/app-registry/appr-cli/releases/download/v0.3.7-dev/cnr-v0.3.7-dev-linux-x64 -L -o /usr/bin/appr
  - chmod +x /usr/bin/appr
  - sed -ri "s/version: 0.0.2/version: $TRAVIS_TAG" chart/cookieapp/Chart.yaml

script:
  - ./test.sh

after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS -e unused quay.io
  - appr login -u $APPR_LOGIN -p $APPR_PASS quay.io

  - docker build -t quay.io/ant31/cookieapp-image:v$TRAVIS_TAG
  - docker push quay.io/ant31/cookieapp-image:v$TRAVIS_TAG

  - cd chart/cookieapp
  - appr push --namespace ant31 staging.quay.io
